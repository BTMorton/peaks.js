<!DOCTYPE html>

<!--

  THIS FILE USED AS PLACEHOLDER HTML FOR DEVELOPMENT PURPOSES

-->

<html>
  <head>
    <title>Peaks.js Demo Page</title>

    <script src="http://localhost:1337/livereload.js"></script>

    <link rel='stylesheet' href='/build/css/peaks.css' />

    <!-- bower -->
    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/lodash/dist/lodash.compat.js"></script>
    <script src="bower_components/KineticJS/index.js"></script>
    <script src="bower_components/eventEmitter/EventEmitter.js"></script>
    <script src="bower_components/handlebars/handlebars.js"></script>
    <script src="bower_components/handlebars/handlebars.runtime.js"></script>
    <script src="bower_components/waveform-data/dist/waveform-data.min.js"></script>
    <!-- endbower -->


    <script type="text/javascript">
        var require = {
          baseUrl: "lib/js/",
          paths: {
            //"WaveformData": "/bower_components/waveform-data/dist/waveform-data.min",
            "WaveformData": "/bower_components/waveform-data/dist/waveform-data",
            "EventEmitter": "/bower_components/eventEmitter/EventEmitter",
            "jquery": "/bower_components/jquery/jquery"
          }
        };
    </script>

    <script main="lib/js/main" src="lib/vendor/require.js"></script>

    <script>

      $(function () {

        require(['main'], function (peaks) {

          peaks = peaks;

          peaks.init({
            container: document.getElementById('waveform-visualiser-container'),
            audioElement: document.getElementById('audio'),
            dataUri: '/test_data/20131119_210000_bbcr4_all_in_the_mind.dat',
            segmentationData: '/test_information_data/20131119_210000_bbcr4_all_in_the_mind_segmentation.json',
            keywordsData: '/test_information_data/20131119_210000_bbcr4_all_in_the_mind_tags.json',
            keyboard: true,
            height: 240,
            segments: [{
              startTime: 120,
              endTime: 140,
              editable: true,
              color: "#ff0000"
            },
            {
              startTime: 420,
              endTime: 540,
              editable: true,
              color: "#0000ff"
            }]
          });

          $("#controls").find("button").on("click", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")][$(this).data("method")]();
          });

          $("#button-controls").find("input").on("click", function (event) {
            event.preventDefault();
            //Don't know if I like the alert? Is the grey fade out of buttons enough to give users indication that you cannot zoom in or out anymore?

            if ($(this).data("method") === "zoomIn" && $(this).attr("disable") === "true") {
              alert("Cannot Zoom In");
            } else if ($(this).data("method") === "zoomOut" && $(this).attr("disable") === "true") {
              alert("Cannot Zoom Out"); 
            } else {
              peaks[$(this).data("namespace")][$(this).data("method")]();
            }
          });

          /*$("#button-controls").find("input").on("mouseover", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")]["showZoomFeedback"]();
          });

          $("#button-controls").find("input").on("mouseout", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")]["hideZoomFeedback"]();
          });

          $("#slider-controls").find("input").on("mouseover", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")]["showZoomFeedback"]();
          });

          $("#slider-controls").find("input").on("mouseout", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")]["hideZoomFeedback"]();
          });*/

          //This allows the user to not have to step on the slider controls to change zoom but it is very laggy so needs to be improved? Replaced by mouse scrolling which gives the user the same functionality 
          $("#slider-controls").find("input").on("change", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")][$(this).data("method")]($(this).val());
          });

          $("#segment").on("click", function (event) {
            startTime = peaks.time.getCurrentTime();
            endTime = startTime + 10;
            segmentEditable = true;
            peaks.segments.addSegment(startTime, endTime, segmentEditable);
          });

          $("#segs").on("click", function (event) {
            console.log(peaks.segments.getSegments());
          });

          $("#inMarker").on("click", function (event) {
            startTime = peaks.time.getCurrentTime();
            peaks.segments.setInMarker(startTime);
          });

          $("#outMarker").on("click", function (event) {
            endTime = peaks.time.getCurrentTime();
            peaks.segments.setOutMarker(endTime);
          });

          if (peaks.currentZoomLevel == 0) {
            $("#zoomIn").attr("disable", "true");
            $("#zoomIn").css("opacity", 0.2);
            $("#zoomIn").css("cursor", "not-allowed");
          } 

          $("#segments").on("change", function (event) {
            if ($("#segments").prop("checked") === false) {
              $("#segmentText").text("Show Segments");
              peaks.segments.segmentVisibility(false);
            } else {
              $("#segmentText").text("Hide Segments");
              peaks.segments.segmentVisibility(true);
            }
          });

          $("#genders").on("change", function (event) {
            if ($("#genders").prop("checked") === false) {
              $("#genderText").text("Show Speakers");
              peaks.segments.genderVisibility(false);
            } else {
              $("#genderText").text("Hide Speakers");
              peaks.segments.genderVisibility(true);
            }
          });

          $("#keywords").on("change", function (event) {
            if ($("#keywords").prop("checked") === false) {
              $("#keywordText").text("Show Keywords");
              peaks.segments.keywordVisibility(false);
            } else {
              $("#keywordText").text("Hide Keywords");
              peaks.segments.keywordVisibility(true);
            }
          });

        });

      });

    </script>

    <style>

      #body {
        cursor: default-pointer;
      }

      #titles, {
        font-family: 'Helvetica neue', Helvetica, Arial, sans-serif;
      }

      #demo-controls {
        margin: 0 auto 24px auto;
        width: 1000px;
      }

      #keyword-information {
        margin: 70px auto 24px auto;
        width:1000px;
      }

      #speaker-information {
        float:left;
      }

      #speaker {
        margin-top:5px;
        margin-bottom: 5px;
      }

      #demo-controls .controls {
        float:left;
        margin-right:20px;
      }

      #demo-controls #button-controls #zoomIn, #demo-controls #button-controls #zoomOut, #demo-controls #marker-controls #inMarker,  #demo-controls #marker-controls #outMarker, #options-controls, #segment-information ul {
        border:2px solid;
        border-radius:5px;
      }

      #titles, #waveform-visualiser-container {
        margin: 24px auto;
        width: 1000px;
      }

      #waveform-visualiser-container > div > div {
        margin: 0 0 24px 0;
        /*height: 240px;*/
        -moz-box-shadow: 3px 3px 20px #919191;
        -webkit-box-shadow: 3px 3px 20px #919191;
        box-shadow: 3px 3px 20px #919191;
      }
    </style>

  </head>
  <body>
      <!--<div id="titles">
        <h1>Peaks.js Demo Page</h1>

        <p>Peaks is a modular frontend component designed for the display of and interaction with audio waveform material in the browser.</p>

        <p>Peaks was developed by <a href="http://www.bbc.co.uk/rd">BBC R&amp;D</a> to allow users to make accurate clippings of audio data over a timeline in browser by leveraging a backend API for encoding.</p>

        <p>Peaks utilizes HTML5 canvas technology to display waveform data at different zoom levels and provides some basic convenience methods for interacting with waveforms and creating time-based visual sections for denoting content to be clipped or for reference eg: distinguishing music from speech or identifying different music tracks.</p>
      </div>-->

      <div id="waveform-visualiser-container">

      </div>

      <div id="demo-controls">
        <audio id="audio" class="controls" controls=controls>
          <source src="/test_data/20131119_210000_bbcr4_all_in_the_mind.mp3" type="audio/mpeg">
          <source src="/test_data/20131119_210000_bbcr4_all_in_the_mind.ogg" type="audio/ogg">
          Your browser does not support the audio element.
        </audio>

        <!--<div id="slider-controls">
          IN <input type="range" name="zoom-controls" min="0" max="3" step="1" value="0" data-namespace="zoom" data-method="changeZoom"> OUT
        </div>-->

        <div id="button-controls" class="controls">
          <input id="zoomIn" type="image" src="images/zoom_in_button.png" alt="Zoom In" width="30" height="29" vspace="0" data-namespace="zoom" data-method="zoomIn">
          <input id="zoomOut" type="image" src="images/zoom_out_button.png" alt="Zoom Out" width="30" height="29" vspace="0" data-namespace="zoom" data-method="zoomOut">
        </div>

        <div id="marker-controls" class="controls">
          <input id="inMarker" type="image" src="images/in_marker_button.png" alt="In Marker" width="30" height="29" vspace="0" data-namespace="" data-method="">
          <input id="outMarker" type="image" src="images/out_marker_button.png" alt="Out Marker" width="30" height="29" vspace="0" data-namespace="" data-method="">
        </div>

        <div id="options-controls" class="controls" style="padding:5px">
          <input id="segments" type="checkbox" checked><label id="segmentText" for="segments">Hide Segments</label>
          <input id="genders" type="checkbox" checked><label id="genderText" for="genders">Hide Speakers</label>
          <input id="keywords" type="checkbox" checked><label id="keywordText" for="keywords">Hide Keywords</label>
        </div>

        <!--<ul id="controls">
          <li><button data-namespace="zoom" data-method="zoomIn">zoom in</button></li>
          <li><button data-namespace="zoom" data-method="zoomOut">zoom out</button></li>
        </ul>-->

        <!--<button id="segment" class="controls" style="margin-top:5px;">10 second segment ...</button>
        <button id="segs">Log Segments</button>-->
      </div>

      <div id="speaker-information">
        <div id="speaker"></div>
      </div>

      <div id="keyword-information">
        <div id="keyword"></div>
      </div>

      <!--<div id="segment-information">
        <ul>
          <li><label id="startTime">Segment Start:100</label></li>
          <li><label id="endTime">Segment End:100</label></li>
          <li><label id="duration">Segment Duration:100</label></li>
        </ul>
      </div>-->
  </body>
</html>
