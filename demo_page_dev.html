<!DOCTYPE html>

<!--

  THIS FILE USED AS PLACEHOLDER HTML FOR DEVELOPMENT PURPOSES

-->

<html>
  <head>
    <title>Peaks.js Demo Page</title>

    <script src="http://localhost:1337/livereload.js"></script>

    <link rel='stylesheet' href='/build/css/peaks.css' />

    <!-- bower -->
    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/lodash/dist/lodash.compat.js"></script>
    <script src="bower_components/KineticJS/index.js"></script>
    <script src="bower_components/eventEmitter/EventEmitter.js"></script>
    <script src="bower_components/handlebars/handlebars.js"></script>
    <script src="bower_components/handlebars/handlebars.runtime.js"></script>
    <script src="bower_components/waveform-data/dist/waveform-data.min.js"></script>
    <!-- endbower -->


    <script type="text/javascript">
        var require = {
          baseUrl: "lib/js/",
          paths: {
            //"WaveformData": "/bower_components/waveform-data/dist/waveform-data.min",
            "WaveformData": "/bower_components/waveform-data/dist/waveform-data",
            "EventEmitter": "/bower_components/eventEmitter/EventEmitter",
            "jquery": "/bower_components/jquery/jquery"
          }
        };
    </script>

    <script main="lib/js/main" src="lib/vendor/require.js"></script>

    <script>

      $(function () {

        require(['main'], function (peaks) {

          peaks = peaks;

          peaks.init({
            container: document.getElementById('waveform-visualiser-container'),
            audioElement: document.getElementById('audio'),
            dataUri: '/test_data/20131119_210000_bbcr4_all_in_the_mind.dat',
            segmentationData: '/test_information_data/20131119_210000_bbcr4_all_in_the_mind_segmentation.json',
            keywordsData: '/test_information_data/20131119_210000_bbcr4_all_in_the_mind_tags.json',
            keyboard: true,
            height: 240,
            /*segments: [{
              startTime: 120,
              endTime: 140,
              editable: true,
              color: "#ff0000"
            },
            {
              startTime: 420,
              endTime: 540,
              editable: true,
              color: "#0000ff"
            }]*/
          });

          $("#controls").find("button").on("click", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")][$(this).data("method")]();
          });

          $("#button-controls").find("input").on("click", function (event) {
            event.preventDefault();
            //Don't know if I like the alert? Is the grey fade out of buttons enough to give users indication that you cannot zoom in or out anymore?

            if ($(this).data("method") === "zoomIn" && $(this).attr("disable") === "true") {
              alert("Cannot Zoom In");
            } else if ($(this).data("method") === "zoomOut" && $(this).attr("disable") === "true") {
              alert("Cannot Zoom Out"); 
            } else {
              peaks[$(this).data("namespace")][$(this).data("method")]();
            }
          });

          /*$("#button-controls").find("input").on("mouseover", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")]["showZoomFeedback"]();
          });

          $("#button-controls").find("input").on("mouseout", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")]["hideZoomFeedback"]();
          });

          $("#slider-controls").find("input").on("mouseover", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")]["showZoomFeedback"]();
          });

          $("#slider-controls").find("input").on("mouseout", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")]["hideZoomFeedback"]();
          });*/

          //This allows the user to not have to step on the slider controls to change zoom but it is very laggy so needs to be improved? Replaced by mouse scrolling which gives the user the same functionality 
          $("#slider-controls").find("input").on("change", function (event) {
            event.preventDefault();
            peaks[$(this).data("namespace")][$(this).data("method")]($(this).val());
          });

          $("#inMarker").on("click", function (event) {
            startTime = peaks.time.getCurrentTime();
            peaks.segments.setInMarker(startTime);
          });

          $("#outMarker").on("click", function (event) {
            endTime = peaks.time.getCurrentTime();
            peaks.segments.setOutMarker(endTime);
          });

          $("#segments").on("change", function (event) {
            if ($("#segments").prop("checked") === false) {
              $("#segmentText").text("Show Segments");
              peaks.segments.segmentVisibility(false);
            } else {
              $("#segmentText").text("Hide Segments");
              peaks.segments.segmentVisibility(true);
            }
          });

          $("#genders").on("change", function (event) {
            if ($("#genders").prop("checked") === false) {
              $("#genderText").text("Show Speakers");
              peaks.segments.genderVisibility(false);
            } else {
              $("#genderText").text("Hide Speakers");
              peaks.segments.genderVisibility(true);
            }
          });

          $("#keywords").on("change", function (event) {
            if ($("#keywords").prop("checked") === false) {
              $("#keywordText").text("Show Keywords");
              peaks.segments.keywordVisibility(false);
            } else {
              $("#keywordText").text("Hide Keywords");
              peaks.segments.keywordVisibility(true);
            }
          });

          $("#drag").on("click", function (event) {
            if ($("#inMarker").attr("disabled") === "disabled") {
              peaks.segments.makeSegment(false);
              $("#drag").css("opacity", 0.2);
              $("#inMarker").removeAttr("disabled");
              $("#outMarker").removeAttr("disabled");
              $("#inMarker").css("opacity", 1);
              $("#outMarker").css("opacity", 1);
              $("#genders").attr("disabled", "disabled");
            } else {
              peaks.segments.makeSegment(true);
              $("#drag").css("opacity", 1);
              $("#inMarker").attr("disabled", "disabled");
              $("#outMarker").attr("disabled", "disabled");
              $("#inMarker").css("opacity", 0.2);
              $("#outMarker").css("opacity", 0.2);
              $("#genders").removeAttr("disabled");
            }
          });
        });

      });

    </script>

    <style>

      @font-face {
        font-family: "Aaargh";
        src: url(/fonts/Aaargh/Aaargh.ttf);
      }

      * {
        font-family: "Aaargh";
        font-size: 12px;
      }

      #body {
        cursor: default-pointer;
      }

      #demo-controls {
        margin: 24px auto 24px auto;
        width: 1000px;
        height:auto;
        overflow:auto;
      }

      #segment-information {
        margin: auto auto auto 132px;
        float:left;
      }

      #segment-information .timeLabel {
        padding-right: 5px;
      }

      #segment-information .time {
        padding-left: 5px;
        padding-right: 5px;
        margin-right: 5px;
        border:2px solid;
        background:#dddddd;
        box-shadow: 1px 2px 5px #888888;
      }

      #speaker-information {
        float:right;
        margin:auto 132px auto 50px;
      }

      #speaker {
        margin:5px 5px 5px 5px;
      }

      #demo-controls .controls {
        float:left;
        margin-right:20px;
      }

      #marker-controls #inMarker, #marker-controls #outMarker {
        opacity: 0.2;
      }

      #demo-controls #button-controls #zoomIn, #demo-controls #button-controls #zoomOut, #demo-controls #marker-controls #inMarker,  #marker-controls #drag, #demo-controls #marker-controls #outMarker, #demo-controls #button-controls #overview, #demo-controls #button-controls #selection, #options-controls {
        border:2px solid;
        border-radius:5px;
        box-shadow: 1px 2px 5px #888888;
      }

      #waveform-visualiser-container {
        margin: 24px auto;
        width: 1000px;
      }

      #waveform-visualiser-container > div > div {
        margin: 0 0 24px 0;
        /*height: 240px;*/
        -moz-box-shadow: 3px 3px 20px #919191;
        -webkit-box-shadow: 3px 3px 20px #919191;
        box-shadow: 3px 3px 20px #919191;
      }
    </style>

  </head>
  <body>

      <div id="demo-controls">
        <audio id="audio" class="controls" controls=controls>
          <source src="/test_data/20131119_210000_bbcr4_all_in_the_mind.mp3" type="audio/mpeg">
          <source src="/test_data/20131119_210000_bbcr4_all_in_the_mind.ogg" type="audio/ogg">
          Your browser does not support the audio element.
        </audio>

        <!--<div id="slider-controls">
          IN <input type="range" name="zoom-controls" min="0" max="3" step="1" value="0" data-namespace="zoom" data-method="changeZoom"> OUT
        </div>-->

        <div id="button-controls" class="controls">
          <input id="zoomIn" type="image" src="images/zoom_in_button.png" alt="Zoom In" width="30" height="29" vspace="0" data-namespace="zoom" data-method="zoomIn" title="Zoom In">
          <input id="zoomOut" type="image" src="images/zoom_out_button.png" alt="Zoom Out" width="30" height="29" vspace="0" data-namespace="zoom" data-method="zoomOut" title="Zoom Out">
          <input id="overview" type="image" src="images/overview_button.png" alt="Fit Overview" width="30" height="29" vspace="0" data-namespace="zoom" data-method="overview" title="Fit Overview">
          <input id="selection" type="image" src="images/selection_button.png" alt="Fit Selection" width="30" height="29" vspace="0" data-namespace="zoom" data-method="selection" title="Fit Selection">
        </div>

        <div id="marker-controls" class="controls">
          <input id="drag" type="image" src="images/scissors.png" alt="Segment" width="30" height="29" vspace="0" data-namespace="" data-method="" title="Make Segment Selection">
          <input id="inMarker" type="image" src="images/in_marker_button.png" alt="In Marker" width="30" height="29" vspace="0" data-namespace="" data-method="" title="Set In Marker" disabled>
          <input id="outMarker" type="image" src="images/out_marker_button.png" alt="Out Marker" width="30" height="29" vspace="0" data-namespace="" data-method="" title="Set Out Marker" disabled>
        </div>

        <div id="options-controls" class="controls" style="padding:5px">
          <input id="segments" type="checkbox" checked><label id="segmentText" for="segments">Hide Segments</label>
          <input id="genders" type="checkbox" checked><label id="genderText" for="genders">Hide Speakers</label>
          <input id="keywords" type="checkbox" checked><label id="keywordText" for="keywords">Hide Keywords</label>
        </div>

        <!--<ul id="controls">
          <li><button data-namespace="zoom" data-method="zoomIn">zoom in</button></li>
          <li><button data-namespace="zoom" data-method="zoomOut">zoom out</button></li>
        </ul>-->

        <!--<button id="segment" class="controls" style="margin-top:5px;">10 second segment ...</button>
        <button id="segs">Log Segments</button>-->
      </div>

      <div id="waveform-visualiser-container">

      </div>

      <div id="speaker-information">
        <div id="speaker"></div>
      </div>

      <div id="segment-information">
        <label class="timeLabel" id="start">Start: </label><label class="time" id="startTime">0:00</label>
        <label class="timeLabel" id="end">End: </label><label class="time" id="endTime">0:00</label>
        <label class="timeLabel" id="duration">Duration: </label><label class="time" id="durationTime">0:00</label>
      </div>
  </body>
</html>
